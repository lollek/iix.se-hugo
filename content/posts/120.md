---
title: Certificates and Java - Packing/Unpacking/Testing p12/pem
date: 2018-12-20T12:00:00Z
categories:
- Application
- SSL
tags:
- tls
- openssl
- p12
- pem
- ssl
---

This post contains a mix of java and certificate info. Note that you should definitely use the p12 format in Java.
Using other types, like p8, usually end up causing issues in the end.
One easy way is by creating a custom trust manager

The easiest way of doing this is: ([See this link for a code example on stackoverflow](https://stackoverflow.com/a/24561444)
1. Create a custom trust manager with your special certs
2. Create a trust manager with the default certs
3. Create a custom trust manager, which takes the custom and the default trust manager and try them both

Another way of doing it would be adding the certificate manually to the cacerts file. 
Note that you will need the full certificate chain for it to work.
```bash
# Replace FILEPATH with the cert-file and ALIAS with any given alias, which can be anything, but must be unique.
sudo keytool -keystore /etc/ssl/certs/java/cacerts -import -file FILEPATH -alias ALIAS
```

## Openssl Commands
```bash
# Unpack whole p12 into pem file
openssl pkcs12 -in infile.p12 -out outfile.pem -nodes

# Unpack key from p12
openssl pkcs12 -in infile.p12 -out outfile.key -nodes -nocerts

# Pack a p12 from pem and key
openssl pkcs12 -export -inkey certfile.key -in certfile.pem -out certfile.p12

# Connect to remote host. You should get some verbose data but the connection should stay open
openssl s_client -connect hostname:443 -cert outfile.pem -key outfile.key

# Check end date of pem file
openssl x509 -enddate -noout -in outfile.pem
```

## Java8 - Cannot use higher ciphers

```
Ignoring unavailable cipher suite: TLS_DHE_DSS_WITH_AES_256_GCM_SHA384
Ignoring unavailable cipher suite: TLS_RSA_WITH_AES_256_CBC_SHA
Ignoring unavailable cipher suite: TLS_DHE_RSA_WITH_AES_256_GCM_SHA384
Ignoring unavailable cipher suite: TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA
Ignoring unavailable cipher suite: TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
Ignoring unavailable cipher suite: TLS_RSA_WITH_AES_256_CBC_SHA256
Ignoring unavailable cipher suite: TLS_DHE_DSS_WITH_AES_256_CBC_SHA
Ignoring unavailable cipher suite: TLS_ECDH_ECDSA_WITH_AES_256_GCM_SHA384
Ignoring unavailable cipher suite: TLS_ECDH_RSA_WITH_AES_256_CBC_SHA384
Ignoring unavailable cipher suite: TLS_RSA_WITH_AES_256_GCM_SHA384
Ignoring unavailable cipher suite: TLS_ECDH_ECDSA_WITH_AES_256_CBC_SHA384
Ignoring unavailable cipher suite: TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384
Ignoring unavailable cipher suite: TLS_ECDH_RSA_WITH_AES_256_CBC_SHA
Ignoring unavailable cipher suite: TLS_ECDH_RSA_WITH_AES_256_GCM_SHA384
Ignoring unavailable cipher suite: TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384
Ignoring unavailable cipher suite: TLS_DHE_RSA_WITH_AES_256_CBC_SHA256
Ignoring unavailable cipher suite: TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA
Ignoring unavailable cipher suite: TLS_DHE_DSS_WITH_AES_256_CBC_SHA256
Ignoring unavailable cipher suite: TLS_DHE_RSA_WITH_AES_256_CBC_SHA
Ignoring unavailable cipher suite: TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA
Ignoring unavailable cipher suite: TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
```

Ignore due to america. You need to manually enable good ciphers if you have a low version of Java8. Otherwise you can also upgrade to 8u161 and it will automatically work.

